<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>站点与集群服务器关系图</title>
  <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.2/dist/echarts.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
    }
    
    body {
      background: linear-gradient(135deg, #0c1e30, #1a3a5f);
      color: #e0f7fa;
      min-height: 100vh;
      padding: 20px;
      overflow-x: hidden;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
    }
    
    header {
      text-align: center;
      padding: 30px 0;
      margin-bottom: 20px;
    }
    
    h1 {
      font-size: 2.8rem;
      margin-bottom: 15px;
      text-shadow: 0 2px 10px rgba(0, 150, 200, 0.6);
      background: linear-gradient(to right, #4facfe, #00f2fe);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      letter-spacing: 1px;
    }
    
    .subtitle {
      font-size: 1.25rem;
      opacity: 0.85;
      max-width: 800px;
      margin: 0 auto;
      line-height: 1.6;
    }
    
    .dashboard {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 30px;
    }
    
    .chart-container {
      flex: 1 1 800px;
      min-height: 600px;
      background: rgba(16, 42, 67, 0.7);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 12px 35px rgba(0, 20, 40, 0.5);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(64, 169, 255, 0.2);
      transition: all 0.4s ease;
    }
    
    .chart-container:hover {
      box-shadow: 0 15px 40px rgba(0, 100, 200, 0.4);
      border-color: rgba(64, 169, 255, 0.35);
    }
    
    #main-chart {
      width: 100%;
      height: 560px;
    }
    
    .info-panel {
      flex: 0 0 300px;
      background: rgba(16, 42, 67, 0.7);
      border-radius: 15px;
      padding: 25px;
      box-shadow: 0 12px 35px rgba(0, 20, 40, 0.5);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(64, 169, 255, 0.2);
      transition: all 0.4s ease;
    }
    
    .info-panel:hover {
      box-shadow: 0 15px 40px rgba(0, 100, 200, 0.4);
      border-color: rgba(64, 169, 255, 0.35);
    }
    
    .panel-title {
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(64, 169, 255, 0.3);
    }
    
    .panel-title h2 {
      font-size: 1.5rem;
      margin-left: 10px;
      background: linear-gradient(to right, #00d2ff, #3a7bd5);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    
    .icon-box {
      width: 40px;
      height: 40px;
      border-radius: 10px;
      background: rgba(0, 210, 255, 0.15);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 18px;
      margin-bottom: 25px;
    }
    
    .stat-card {
      background: rgba(0, 120, 215, 0.15);
      border-radius: 12px;
      padding: 20px 15px;
      text-align: center;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      border: 1px solid rgba(64, 169, 255, 0.15);
    }
    
    .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
    }
    
    .stat-card:nth-child(1)::before { background: linear-gradient(90deg, #4facfe, #00f2fe); }
    .stat-card:nth-child(2)::before { background: linear-gradient(90deg, #4caf50, #8bc34a); }
    .stat-card:nth-child(3)::before { background: linear-gradient(90deg, #ff9800, #ffc107); }
    .stat-card:nth-child(4)::before { background: linear-gradient(90deg, #f44336, #ff5252); }
    
    .stat-card:hover {
      transform: translateY(-5px);
      background: rgba(0, 120, 215, 0.25);
      box-shadow: 0 8px 20px rgba(0, 60, 120, 0.3);
    }
    
    .stat-label {
      font-size: 1rem;
      opacity: 0.85;
      margin-bottom: 8px;
    }
    
    .stat-value {
      font-size: 2.4rem;
      font-weight: bold;
      margin: 5px 0;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
    }
    
    .healthy { color: #4caf50; }
    .subhealthy { color: #ff9800; }
    .unhealthy { color: #f44336; }
    
    .status-list {
      margin-top: 25px;
      max-height: 300px;
      overflow-y: auto;
      padding-right: 5px;
    }
    
    .status-list::-webkit-scrollbar {
      width: 6px;
    }
    
    .status-list::-webkit-scrollbar-thumb {
      background: rgba(64, 169, 255, 0.5);
      border-radius: 3px;
    }
    
    .status-item {
      padding: 15px;
      margin-bottom: 12px;
      background: rgba(0, 60, 120, 0.2);
      border-radius: 10px;
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
      cursor: pointer;
      border: 1px solid rgba(64, 169, 255, 0.1);
    }
    
    .status-item:hover {
      background: rgba(0, 100, 200, 0.3);
      transform: translateX(5px);
      border-color: rgba(64, 169, 255, 0.3);
    }
    
    .status-indicator {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      margin-right: 15px;
    }
    
    .status-name {
      flex-grow: 1;
      font-weight: 500;
      font-size: 1.05rem;
    }
    
    .server-count {
      background: rgba(0, 150, 255, 0.2);
      padding: 3px 10px;
      border-radius: 20px;
      font-size: 0.9rem;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 25px;
      flex-wrap: wrap;
    }
    
    .btn {
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: white;
      border: none;
      padding: 14px 30px;
      border-radius: 50px;
      cursor: pointer;
      font-size: 1.05rem;
      font-weight: 500;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      box-shadow: 0 5px 15px rgba(0, 114, 255, 0.3);
      min-width: 180px;
      justify-content: center;
    }
    
    .btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 114, 255, 0.4);
    }
    
    .btn.secondary {
      background: linear-gradient(135deg, #ff7e5f, #feb47b);
    }
    
    .btn.tertiary {
      background: linear-gradient(135deg, #7b4397, #dc2430);
    }
    
    .btn i {
      font-size: 1.3rem;
    }
    
    .footer {
      text-align: center;
      margin-top: 50px;
      padding: 20px;
      opacity: 0.7;
      font-size: 0.95rem;
    }
    
    .legend {
      display: flex;
      justify-content: center;
      gap: 30px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 1rem;
    }
    
    .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 4px;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    @media (max-width: 1200px) {
      .dashboard {
        flex-direction: column;
      }
      
      .chart-container {
        min-height: 500px;
      }
      
      .info-panel {
        flex: 1 1 auto;
      }
    }
    
    @media (max-width: 768px) {
      h1 {
        font-size: 2.2rem;
      }
      
      .subtitle {
        font-size: 1.05rem;
      }
      
      .chart-container {
        min-height: 400px;
        padding: 15px;
      }
      
      .stat-value {
        font-size: 2rem;
      }
      
      .btn {
        padding: 12px 20px;
        min-width: 160px;
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <div id="app" class="container">
    <header>
      <h1>站点与集群服务器关系图</h1>
      <p class="subtitle">主站点位于顶部中央，集群服务器分布在下方。集群状态分为健康、亚健康和不健康三种状态。</p>
      
      <div class="legend">
        <div class="legend-item">
          <div class="legend-color" style="background: #5470c6;"></div>
          <div>主站点</div>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #4caf50;"></div>
          <div>健康集群</div>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #ff9800;"></div>
          <div>亚健康集群</div>
        </div>
        <div class="legend-item">
          <div class="legend-color" style="background: #f44336;"></div>
          <div>不健康集群</div>
        </div>
      </div>
    </header>
    
    <div class="dashboard">
      <div class="chart-container">
        <div id="main-chart"></div>
      </div>
      
      <div class="info-panel">
        <div class="panel-title">
          <div class="icon-box">📊</div>
          <h2>集群状态概览</h2>
        </div>
        
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-label">集群总数</div>
            <div class="stat-value">{{ clusters.length }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">健康集群</div>
            <div class="stat-value healthy">{{ healthyCount }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">亚健康集群</div>
            <div class="stat-value subhealthy">{{ subhealthyCount }}</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">不健康集群</div>
            <div class="stat-value unhealthy">{{ unhealthyCount }}</div>
          </div>
        </div>
        
        <div class="panel-title">
          <div class="icon-box">📋</div>
          <h2>集群列表</h2>
        </div>
        <div class="status-list">
          <div 
            v-for="(cluster, index) in clusters" 
            :key="cluster.id"
            class="status-item"
            @mouseenter="highlightCluster(cluster.id)"
            @mouseleave="resetHighlight"
            @click="focusCluster(cluster.id)"
          >
            <div class="status-indicator" :class="getStatusClass(cluster)"></div>
            <div class="status-name">{{ cluster.name }}</div>
            <div class="server-count">{{ cluster.servers }}台</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="controls">
      <button class="btn" @click="addCluster">
        <i>+</i> 添加集群
      </button>
      <button class="btn secondary" @click="randomizeStatus">
        <i>🔄</i> 随机状态
      </button>
      <button class="btn tertiary" @click="resetLayout">
        <i>↻</i> 重置布局
      </button>
      <button class="btn" @click="removeCluster">
        <i>−</i> 删除集群
      </button>
    </div>
    
    <div class="footer">
      <p>基于 Vue.js 和 ECharts 实现 | 主站点在顶部布局 | 集群状态可视化</p>
    </div>
  </div>

  <script>
    new Vue({
      el: '#app',
      data: {
        myChart: null,
        clusters: [],
        siteNode: {
          id: 'site',
          name: '主数据中心',
          value: 100,
          itemStyle: { 
            color: '#5470c6', 
            borderWidth: 2, 
            borderColor: '#a0c0ff',
            shadowColor: 'rgba(0, 150, 255, 0.5)',
            shadowBlur: 15
          },
          symbolSize: [180, 80],
          symbol: 'rect',
          label: {
            show: true,
            position: 'inside',
            fontSize: 18,
            fontWeight: 'bold',
            color: '#fff'
          },
          fixed: true
        },
        nextId: 1
      },
      computed: {
        healthyCount() {
          return this.clusters.filter(c => c.status === '健康').length;
        },
        subhealthyCount() {
          return this.clusters.filter(c => c.status === '亚健康').length;
        },
        unhealthyCount() {
          return this.clusters.filter(c => c.status === '不健康').length;
        }
      },
      mounted() {
        this.initChart();
        this.generateData(6); // 初始生成6个集群
        window.addEventListener('resize', this.handleResize);
      },
      beforeDestroy() {
        window.removeEventListener('resize', this.handleResize);
      },
      methods: {
        initChart() {
          const chartDom = document.getElementById('main-chart');
          this.myChart = echarts.init(chartDom);
          
          const option = {
            tooltip: {
              trigger: 'item',
              formatter: (params) => {
                if (params.dataType === 'node') {
                  const node = params.data;
                  if (node.id === 'site') {
                    return `<b>主站点</b><br>${node.name}<br>连接集群数: ${this.clusters.length}`;
                  }
                  return `<b>${node.name}</b><br>状态: ${node.status}<br>服务器数量: ${node.servers}台`;
                }
                return `${params.source} → ${params.target}`;
              },
              backgroundColor: 'rgba(10, 25, 50, 0.9)',
              borderColor: '#47b8e0',
              textStyle: { color: '#fff' },
              extraCssText: 'box-shadow: 0 0 15px rgba(0, 200, 255, 0.5);'
            },
            animation: true,
            animationDuration: 1000,
            animationEasing: 'cubicOut',
            series: [{
              type: 'graph',
              layout: 'none', // 使用自定义布局
              draggable: true,
              roam: true,
              focusNodeAdjacency: true,
              edgeSymbol: ['none', 'arrow'],
              edgeSymbolSize: [0, 15],
              edgeLabel: {
                show: false
              },
              lineStyle: {
                width: 3,
                curveness: 0.2,
                opacity: 0.8,
                color: 'source',
                type: 'solid'
              },
              label: {
                show: true,
                position: 'inside',
                fontSize: 14,
                fontWeight: 'bold',
                color: '#fff'
              },
              emphasis: {
                scale: true,
                itemStyle: {
                  borderWidth: 3,
                  borderColor: '#fff',
                  shadowBlur: 20,
                  shadowColor: 'rgba(0, 200, 255, 0.8)'
                },
                lineStyle: {
                  width: 5,
                  opacity: 1
                }
              }
            }]
          };
          
          this.myChart.setOption(option);
          
          // 点击事件
          this.myChart.on('click', (params) => {
            if (params.dataType === 'node' && params.data.id !== 'site') {
              this.focusCluster(params.data.id);
            }
          });
        },
        
        getStatusClass(cluster) {
          return {
            'healthy': cluster.status === '健康',
            'subhealthy': cluster.status === '亚健康',
            'unhealthy': cluster.status === '不健康'
          };
        },
        
        getClusterColor(status) {
          return status === '健康' ? '#4caf50' : 
                 status === '亚健康' ? '#ff9800' : '#f44336';
        },
        
        generateData(count) {
          // 生成集群数据
          for (let i = 0; i < count; i++) {
            this.clusters.push(this.createCluster());
          }
          
          // 计算集群位置
          this.calculateClusterPositions();
          
          // 更新图表
          this.updateChart();
        },
        
        createCluster() {
          const statuses = ['健康', '亚健康', '不健康'];
          const status = statuses[Math.floor(Math.random() * statuses.length)];
          const servers = Math.floor(Math.random() * 20) + 5; // 5-25台服务器
          
          const cluster = {
            id: `cluster${this.nextId}`,
            name: `集群 ${this.nextId}`,
            status: status,
            servers: servers,
            symbol: 'rect',
            symbolSize: [140, 60],
            itemStyle: { 
              color: this.getClusterColor(status),
              borderWidth: 2,
              borderColor: status === '健康' ? '#a5d6a7' : 
                          status === '亚健康' ? '#ffe082' : '#ef9a9a'
            },
            label: {
              show: true,
              position: 'inside',
              fontSize: 14,
              fontWeight: 'bold',
              color: '#fff'
            },
            value: servers * 10,
            draggable: true
          };
          
          this.nextId++;
          return cluster;
        },
        
        calculateClusterPositions() {
          if (!this.myChart) return;
          
          const containerWidth = this.myChart.getWidth();
          // 设置站点位置在顶部中央
          this.siteNode.x = containerWidth / 2;
          this.siteNode.y = 80;

          const startY = 180; // 集群起始Y位置
          const maxPerRow = Math.min(4, this.clusters.length);
          const horizontalSpacing = 200;
          const verticalSpacing = 120;
          const startX = (containerWidth - (maxPerRow - 1) * horizontalSpacing) / 2;
          
          this.clusters.forEach((cluster, index) => {
            const row = Math.floor(index / maxPerRow);
            const col = index % maxPerRow;
            
            cluster.x = startX + col * horizontalSpacing;
            cluster.y = startY + row * verticalSpacing;
          });
        },
        
        updateChart() {
          const links = this.clusters.map(cluster => ({
            source: 'site',
            target: cluster.id,
            lineStyle: {
              color: this.getClusterColor(cluster.status)
            }
          }));
          
          // 更新图表数据
          this.myChart.setOption({
            series: [{
              data: [this.siteNode, ...this.clusters],
              links: links
            }]
          });
        },
        
        addCluster() {
          const newCluster = this.createCluster();
          this.clusters.push(newCluster);
          this.calculateClusterPositions();
          this.updateChart();
        },
        
        removeCluster() {
          if (this.clusters.length > 0) {
            this.clusters.pop();
            this.calculateClusterPositions();
            this.updateChart();
          }
        },
        
        randomizeStatus() {
          const statuses = ['健康', '亚健康', '不健康'];
          
          this.clusters.forEach(cluster => {
            const newStatus = statuses[Math.floor(Math.random() * statuses.length)];
            cluster.status = newStatus;
            cluster.itemStyle.color = this.getClusterColor(newStatus);
            cluster.itemStyle.borderColor = newStatus === '健康' ? '#a5d6a7' : 
                                          newStatus === '亚健康' ? '#ffe082' : '#ef9a9a';
          });
          
          this.updateChart();
        },
        
        resetLayout() {
          this.calculateClusterPositions();
          this.updateChart();
        },
        
        highlightCluster(clusterId) {
          const index = this.clusters.findIndex(c => c.id === clusterId);
          if (index !== -1) {
            this.myChart.dispatchAction({
              type: 'highlight',
              seriesIndex: 0,
              dataIndex: index + 1 // +1 是因为第一个节点是站点
            });
          }
        },
        
        focusCluster(clusterId) {
          const index = this.clusters.findIndex(c => c.id === clusterId);
          if (index !== -1) {
            this.myChart.dispatchAction({
              type: 'focusNodeAdjacency',
              seriesIndex: 0,
              dataIndex: index + 1
            });
          }
        },
        
        resetHighlight() {
          this.myChart.dispatchAction({
            type: 'downplay'
          });
        },
        
        handleResize() {
          if (this.myChart) {
            this.myChart.resize();
            this.calculateClusterPositions();
            this.updateChart();
          }
        }
      }
    });
  </script>
</body>
</html>